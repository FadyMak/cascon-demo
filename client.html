<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="//cdn.techpines.io/jquery.event.drag-2.0.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="jscolor/jscolor.js"></script>
<script>
    App = {}
    App.socket = io.connect()

    var drawTools = {
        PENCIL: "pencil",
        PAINTBRUSH: "paintbrush",
        ERASER: "eraser"
    };
    

    var clr = "#000000";
    var brs = "1";
    var drawType = drawTools.PENCIL;

    // Draw Function
    App.draw = function(data) {
        if (data.type == "dragstart") {
            App.ctx.beginPath()
            App.ctx.moveTo(data.x,data.y)
        } else if (data.type == "drag") {
            App.ctx.lineTo(data.x,data.y)
            App.ctx.stroke()
        } else {
            App.ctx.stroke()
            App.ctx.closePath()
        }

        console.log(clr);
        App.ctx.strokeStyle = clr;
        App.ctx.lineWidth = brs;
    }

    function colorChange()
    {
        if(drawType != drawTools.ERASER){
            clr = "#" + document.getElementById('colorIn').value;
        }
    }

    function pencil()
    {
        clr = "#" + document.getElementById('colorIn').value;
        brs = brs/10;
        drawType = drawTools.PENCIL;

        //change cursor to paintbrush
        document.getElementById("canvas").style.cursor = "url('icons/pencil.png') 5 100, auto";
    }

    function paintBrush()
    {
        clr = "#" + document.getElementById('colorIn').value;
        brs = document.getElementById('resizeIn').value;
        drawType = drawTools.PAINTBRUSH;

        //change cursor to paintbrush
        document.getElementById("canvas").style.cursor = "url('icons/paintbrush.png') 4 100, auto";
    }

    function eraser()
    {
        clr = "#FFFFFF";
        brs = document.getElementById('resizeIn').value;
        drawType = drawTools.ERASER;

        //change cursor to eraser
        document.getElementById("canvas").style.cursor = "url('icons/eraser.png') 6 100, auto";
    }

    function resize()
    {
        brs = document.getElementById('resizeIn').value;
        if (drawType == drawTools.PENCIL)
        {
            brs = brs/10;
        }
    }

    // Draw from other sockets
    App.socket.on('draw', App.draw)

    // Bind click and drag events to drawing and sockets.
    $(function() {
        App.ctx = $('canvas')[0].getContext("2d")
        $('canvas').live('drag dragstart dragend', function(e) {
            offset = $(this).offset()
            data = {
                x: (e.clientX - offset.left),
                y: (e.clientY - offset.top),
                type: e.handleObj.type
            }
            App.draw(data) // Draw yourself.
            App.socket.emit('drawClick', data) // Broadcast draw.
        })
    })
</script>

<style>
.drawTools {
    background-color: #C1C1C1;
}

#title {
    text-align: center;
    font-weight: bold;
    font-size: 250%;
    background-color: #A1A1A1;
}
.drawButton {
    width: 20px;
    height: 20px;
}

#canvas {
    cursor:url('icons/pencil.png') 5 100, auto;
}

#colorIn {
    width: 60;
}
</style>

<div class="drawTools">
    <div id="title"> 
        CASCON 2015 - NODE JS CANVAS DEMO
    </div>
    Tools: 
    <input class="color" id="colorIn" value="000000" onchange="colorChange()">
    <input class="drawButton" id="pencilIn" type="image" src="icons/pencil.png" value="Pencil" onclick="pencil()">
    <input class="drawButton" id="brushIn" type="image" src="icons/paintbrush.png" value="Brush" onclick="paintBrush()">
    <input class="drawButton" id="eraseIn" type="image" src="icons/eraser.png" value="Eraser" onclick="eraser()">
    <select class="resize" id="resizeIn" value="10" onchange="resize()">
      <option selected="true" disabled="disabled" value="10">SIZE</option>
      <option value="10">10</option>
      <option value="15">15</option>
      <option value="20">20</option>
      <option value="25">25</option>
      <option value="30">30</option>
      <option value="35">35</option>
      <option value="40">40</option>
      <option value="45">45</option>
      <option value="50">50</option>
    </select>
</div>
<canvas id="canvas" width="2000" height="2000" style=""></canvas>
